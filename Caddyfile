# ===========================================
# Calricula - Caddy Reverse Proxy Config
# ===========================================
# Caddy automatically provisions and renews SSL certificates via Let's Encrypt

calricula.com, www.calricula.com {
	# Enable compression
	encode gzip zstd

	# Frontend - serve Next.js app
	handle {
		reverse_proxy frontend:3000
	}

	# API routes - proxy to backend
	handle /api/* {
		reverse_proxy backend:8000
	}

	# Health check endpoint for the proxy itself
	handle /caddy-health {
		respond "OK" 200
	}

	# Security headers
	header {
		# Prevent clickjacking
		X-Frame-Options "SAMEORIGIN"
		# Prevent MIME type sniffing
		X-Content-Type-Options "nosniff"
		# XSS protection
		X-XSS-Protection "1; mode=block"
		# Referrer policy
		Referrer-Policy "strict-origin-when-cross-origin"
		# Remove server header
		-Server
	}

	# Logging
	log {
		output stdout
		format json
		level INFO
	}
}
